# í”„ë¡œì íŠ¸ ëª… : ë‹¹ì‹ ë§ˆì¼“ ( EduSecond )


## ğŸ“– í”„ë¡œì íŠ¸ ì†Œê°œ
> ì„ ìƒë‹˜ì„ ìœ„í•œ ì¤‘ê³ ê±°ë˜ ì‚¬ì´íŠ¸ ë‹¹ì‹ ë§ˆì¼“
- ì„ ìƒë‹˜ì„ ìœ„í•œ ë‹¹ì‹ ë§ˆì¼“ì€ ì¤‘ê³ ê±°ë˜ê°€ í•„ìš”í•œ êµì‚¬ê°€ ì†ì‰½ê²Œ í•„ìš”í•œ ë¬¼í’ˆë“¤ì„ ì¤‘ê³ ê±°ë˜ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.

## ğŸ‘¥ íŒ€ì› ì†Œê°œ
|ì´ë¦„|ì—­í• |ë‹´ë‹¹ ê¸°ëŠ¥|GitHub|
|---|---|---|---|
|í•œì¸ê·œ|íŒ€ì¥|â€¢ ìƒí’ˆ ê²°ì œ<br>â€¢ ê±°ë˜ í›„ê¸°<br>â€¢ ë§ˆì´í˜ì´ì§€|[@GitHub](https://github.com/Haninqq)|
|ê°•ê²½ë¯¼|íŒ€ì›|â€¢ ê´€ë¦¬ì í˜ì´ì§€<br>â€¢ DB ì„¤ê³„<br>â€¢ ì±„íŒ…<br>â€¢ í•„í„°|[@GitHub](https://github.com/GyeongMin2)|
|ì†¡ìˆ˜ë¯¸|íŒ€ì›|â€¢ í˜ì´ì§• ê³µí†µëª¨ë“ˆ ì„¤ê³„<br>â€¢ ìƒí’ˆ ìƒì„¸<br>â€¢ ì°œëª©ë¡<br>â€¢ ë§ˆì´í˜ì´ì§€|[@GitHub](https://github.com/SumiSong)|
|ìµœì‚¬ë‘|íŒ€ì›|â€¢ í”„ë¡ íŠ¸ì—”ë“œ í¼ë¸”ë¦¬ì‹±<br>â€¢ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸<br>â€¢ íšŒì‚¬ ì†Œê°œ<br>â€¢ ê³µì§€ ì‚¬í•­|[@GitHub](https://github.com/coeisarang)|

## ğŸ“… í”„ë¡œì íŠ¸ ì¼ì •

| ë‹¨ê³„     | 11/11 | 11/12 | 11/13 | 11/14 | 11/15 | 11/16 | 11/17 |
| ------ | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| ìš”êµ¬ë¶„ì„   | âœ“     |       |       |       |       |       |       |
| DB ì„¤ê³„  |       | âœ“     | âœ“     |       |       |       |       |
| ê¸°ëŠ¥ ëª…ì„¸ì„œ |       |       | âœ“     |       |       |       |       |
| ê°œë°œ     |       | âœ“     | âœ“     | âœ“     | âœ“     | âœ“     |       |
| í…ŒìŠ¤íŠ¸&ë°°í¬ |       |       |       |       |       | âœ“     | âœ“     |

## ğŸ›  ê°œë°œ í™˜ê²½
### Frontend
- JSP
- JavaScript
- Bootstrap 5

### Backend
- Java
- Spring Framework
- Maven

### Database & Server
- MariaDB & MySQL
- Apache Tomcat 9.0.96

### Tools
- Git & GitHub
- IntelliJ IDEA

## ğŸ’¡ì£¼ìš” ê¸°ëŠ¥
### 1. íšŒì› ê´€ë¦¬ (ë‹´ë‹¹ : ìµœì‚¬ë‘)
- íšŒì›ê°€ì…
- ë¡œê·¸ì¸
- ë¡œê·¸ì•„ì›ƒ
- ì •ë³´ ìˆ˜ì •

### 2. ìƒí’ˆ ê´€ë¦¬ (ë‹´ë‹¹ : í•œì¸ê·œ, ì†¡ìˆ˜ë¯¸)
- ìƒí’ˆ ë“±ë¡ ìˆ˜ì • ì‚­ì œ
- ìƒí’ˆ ìƒì„¸
- ìƒí’ˆ ê²°ì œ
- ìƒí’ˆ ì°œ
- ê±°ë˜ í›„ê¸°

### 3. ì±„íŒ… ê´€ë¦¬ (ë‹´ë‹¹ : ê°•ê²½ë¯¼)
- ì±„íŒ…
- ì±„íŒ… ëª©ë¡
- ì±„íŒ… ìƒì„¸

### 4. ê´€ë¦¬ì í˜ì´ì§€ (ë‹´ë‹¹ : ê°•ê²½ë¯¼)
- ê³µì§€ì‚¬í•­ ë“±ë¡ ìˆ˜ì • ì‚­ì œ
- íšŒì› ê´€ë¦¬
- ìƒí’ˆ ê´€ë¦¬

### 5. í˜ì´ì§• ëª¨ë“ˆ (ë‹´ë‹¹ : ì†¡ìˆ˜ë¯¸)
- ë°±ì—”ë“œ í˜ì´ì§• ëª¨ë“ˆ
- í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§• ëª¨ë“ˆ

## ğŸ“Š ERD & Class Diagram & í™”ë©´ ì„¤ê³„ì„œ
![ERD](https://github.com/GyeongMin2/MyPortfolio/blob/main/images/eduSecond/eduSecond_ERD.png)
![Class Diagram](https://github.com/GyeongMin2/MyPortfolio/blob/main/images/eduSecond/eduSecond_classdiagram.png)
![í™”ë©´ ì„¤ê³„ì„œ](https://github.com/GyeongMin2/MyPortfolio/blob/main/images/eduSecond/Screen_Design_Document.jpg)

## ğŸ’» ì£¼ìš” ì½”ë“œ

### í•œì¸ê·œ
#### ìƒí’ˆ ê²°ì œ êµ¬í˜„
- í”„ë¡œì‹œì €ë¥¼ í™œìš©í•œ ê²°ì œ ì²˜ë¦¬
```sql
DELIMITER //

CREATE PROCEDURE reductAfterPayment(IN p_productId INT, IN orderQuantity INT)
BEGIN
    DECLARE availableQuantity INT;

    -- í˜„ì¬ ì¬ê³  í™•ì¸
    SELECT quantity INTO availableQuantity
    FROM tbl_product
    WHERE productId = p_productId;

    -- ì¬ê³ ê°€ ì¶©ë¶„í•œì§€ í™•ì¸
    IF availableQuantity >= orderQuantity THEN
        -- ì¬ê³  ê°ì†Œ
        UPDATE tbl_product
        SET quantity = quantity - orderQuantity
        WHERE productId = p_productId;

        -- ê°ì†Œ í›„ ì¬ê³  í™•ì¸ ë° ìƒíƒœ ë³€ê²½
        IF (availableQuantity - orderQuantity) = 0 THEN
            UPDATE tbl_product
            SET productStatus = 'SOLDOUT'
            WHERE productId = p_productId;
        END IF;

    ELSE
        -- ì¬ê³  ë¶€ì¡± ì‹œ ì˜ˆì™¸ ë°œìƒ
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Insufficient stock';
    END IF;
END //

DELIMITER ;
```
```xml
<update id="reductionAfterPayment">
    CALL reductAfterPayment(#{productId}, #{orderQuantity})
</update>
```
```java
@GetMapping("/confirm")
    public String confirm(@RequestParam("paymentNumber") String paymentNumber,
                                @RequestParam(defaultValue = "1") int pageNo, HttpServletResponse response) {
        response.setCharacterEncoding("UTF-8");
        int result = orderMapper.confirm(paymentNumber);

        if (result > 0) {
            PaymentDTO paymentDTO = paymentMapper.getPaymentInfo(paymentNumber);
            int result1 = productMapper.reductionAfterPayment(paymentDTO); // ìƒí’ˆì •ë³´ì—ì„œ ê°œìˆ˜ ì°¨ê°í•˜ëŠ” ë©”ì„œë“œ

            if(result1 >0){
                JSFunc.alertLocation("êµ¬ë§¤ ìˆ˜ë½/ìƒí’ˆ ê°œìˆ˜ ì°¨ê°.","/es/mypage/orderList_1?pageNo="+pageNo, response);
            } else{
                JSFunc.alertLocation("êµ¬ë§¤ ìˆ˜ë½/ìƒí’ˆ ê°œìˆ˜ ì°¨ê° ì˜¤ë¥˜. ìˆ˜ì • í•„ìš”","/es/mypage/orderList_1?pageNo="+pageNo, response);
            }
        } else {
            JSFunc.alertBack("êµ¬ë§¤ ìˆ˜ë½ ì‹¤íŒ¨", response);
        }
        return null;
    }
```

### ìµœì‚¬ë‘
#### ë°˜ì‘í˜• í—¤ë” êµ¬í˜„
```css
@media (max-width: 1000px) {
  .menu-toggle {
    display: block;
  }

  .navbar nav ul {
    display: none; /* Hide by default */
    flex-direction: column;
    gap: 0;
    background-color: #ffffff;
    position: absolute;
    top: 60px;
    left: 0;
    width: 100%;
    padding: 10px;
    border-top: 1px solid #ffffff;
  }

  .navbar nav ul.show {
    display: flex;
    z-index: 1000;
  }

  .navbar nav ul li {
    padding: 10px 0;
  }
}
```

#### ë„¤ì´ë²„ ì§€ë„ API ì—°ë™
- íšŒì‚¬ ìœ„ì¹˜ í‘œì‹œë¥¼ ìœ„í•œ ë„¤ì´ë²„ ì§€ë„ API êµ¬í˜„
- ë§ˆì»¤ ì»¤ìŠ¤í…€ ë° ì§€ë„ ì˜µì…˜ ì„¤ì •
- ë°˜ì‘í˜• ì§€ë„ í¬ê¸° ì¡°ì ˆ

```javascript
// ë„¤ì´ë²„ ì§€ë„ API ì´ˆê¸°í™” ë° ì„¤ì •
var mapOptions = {
    center: new naver.maps.LatLng(37.4787, 126.8866),
    zoom: 15
};

var map = new naver.maps.Map('map', mapOptions);

// ì»¤ìŠ¤í…€ ë§ˆì»¤ ìƒì„±
var marker = new naver.maps.Marker({
    position: new naver.maps.LatLng(37.4787, 126.8866),
    map: map,
    icon: {
        url: 'https://path-to-your-arrow-icon.png',
        size: new naver.maps.Size(50, 50),
        scaledSize: new naver.maps.Size(50, 50),
        origin: new naver.maps.Point(0, 0),
        anchor: new naver.maps.Point(25, 50)
    }
});
```

```html
<!-- ì§€ë„ë¥¼ í‘œì‹œí•  HTML ìš”ì†Œ -->
<div class="timeline">
    <h2>ì°¾ì•„ì˜¤ëŠ” ê¸¸</h2>
    <hr>
    <div class="banner">
        <div id="map" style="width:100%;height:400px;"></div>
    </div>
    <p>
        ë„ë¡œëª… : ì„œìš¸ ê¸ˆì²œêµ¬ ë²šê½ƒë¡œ 266 ë§ˆë¦¬ì˜¤ì•„ìš¸ë ›3ê´€
        ì§€ë²ˆ : ê°€ì‚°ë™ 60-20 ìš°í¸ë²ˆí˜¸ : 08511
    </p>
    <p style="text-align: left">
        17ê°€ì‚°ë””ì§€í„¸ë‹¨ì§€ì—­ 3ë²ˆ ì¶œêµ¬ì—ì„œ 247m
    </p>
</div>
```

### ê°•ê²½ë¯¼
#### WebSocket ì±„íŒ… êµ¬í˜„
- WebSocketì„ í™œìš©í•œ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ ì±„íŒ… êµ¬í˜„
- í•˜ì´ë¸Œë¦¬ë“œ í†µì‹  ë°©ì‹ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´
- ì½ìŒ ì²˜ë¦¬ ë° ì±„íŒ…ë°© ê´€ë¦¬ ê¸°ëŠ¥

```java
@Override
protected void handleTextMessage(WebSocketSession session, TextMessage message) {
    try {
        String roomId = session.getUri().getQuery().split("=")[1];
        ChatMessageDTO chatMessage = gson.fromJson(message.getPayload(), ChatMessageDTO.class);
        
        chatService.saveMessage(chatMessage);
        
        Map<WebSocketSession, String> sessions = roomSessions.get(roomId);
        if (sessions != null) {
            String messageJson = gson.toJson(chatMessage);
            sessions.keySet().forEach(s -> {
                try {
                    if (s.isOpen()) {
                        s.sendMessage(new TextMessage(messageJson));
                    }
                } catch (Exception e) {
                    log.error("ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨", e);
                }
            });
        }
    } catch (Exception e) {
        log.error("ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì—ëŸ¬ ë°œìƒ", e);
    }
}
```

#### ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬
- ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì‹¤ì‹œê°„ ë°˜ì˜
- ìµœì‹  ë©”ì‹œì§€ ê¸°ì¤€ ì •ë ¬
- ì‚¬ìš©ìë³„ í™œì„±í™”ëœ ì±„íŒ…ë°©ë§Œ ì¡°íšŒ

```sql
SELECT 
    c.roomId, c.productId, c.sellerId, c.buyerId,
    p.productName, pi.imagePath as productImage,
    m.userName as otherUserName,
    lcm.message as lastMessage,
    lcm.regDate as lastMessageDate,
    COALESCE((
        SELECT COUNT(*) 
        FROM tbl_chat_message 
        WHERE roomId = c.roomId 
        AND isRead = 'N' 
        AND senderId != #{userId}
    ), 0) as unreadCount
FROM tbl_chatroom c
LEFT JOIN tbl_product p ON c.productId = p.productId
LEFT JOIN tbl_product_image pi ON p.productId = pi.productId 
    AND pi.isMain = 'Y'
WHERE (c.sellerId = #{userId} AND c.sellerActive = 'Y') 
   OR (c.buyerId = #{userId} AND c.buyerActive = 'Y')
ORDER BY lcm.regDate DESC
```

#### í”„ë¡ íŠ¸ì—”ë“œ WebSocket ì—°ê²°
- ìë™ ì¬ì—°ê²° ë° ì—ëŸ¬ ì²˜ë¦¬
- í•˜ì´ë¸Œë¦¬ë“œ í†µì‹  êµ¬í˜„ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´

```javascript
function connect() {
    ws = new WebSocket(`ws://${window.location.host}/es/ws/chat?roomId=${roomId}`);
    ws.onmessage = onMessage;
    ws.onerror = (error) => {
        console.error('WebSocket Error:', error);
    };
}

function sendMessage() {
    const message = messageInput.value.trim();
    if (!message) return;
    
    const chatMessage = {
        type: 'CHAT',
        roomId: roomId,
        senderId: userId,
        message: message
    };

    // WebSocket ë˜ëŠ” HTTP í†µì‹ 
    if (ws?.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify(chatMessage));
    } else {
        fetch('/message/send', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(chatMessage)
        });
    }
}
```
### ì†¡ìˆ˜ë¯¸
#### í˜ì´ì§• ëª¨ë“ˆ êµ¬í˜„
- ë°±ì—”ë“œ í˜ì´ì§• ëª¨ë“ˆ
- í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§• ëª¨ë“ˆ
```java
public class Paging {
    private int pageNo;
    private int pageSize;
    private int blockSize;
    private int totalCnt;
    public int getStartIdx(){
        return  (pageNo - 1) * pageSize;
    }

    public int getTotalPage(){
        return  (int) Math.ceil((double) totalCnt / pageSize);
    }
    public int getStartBlockPage(){
        return ((pageNo - 1) / blockSize) * blockSize + 1;
    }
    public int getEndBlockPage() {
        int endPage = getStartBlockPage() + blockSize - 1;
        return Math.min(endPage, getTotalPage());
    }
    public boolean getPrevBlock () {
        return getStartBlockPage() > 1;
    }
    public boolean getNextBlock () {
        return getEndBlockPage() < getTotalPage();
    }
}
```
```java
private boolean validateListParameters(int pageNo, String searchCategory,
                                        String searchValue, HttpServletResponse response) {
        if (pageNo < 1) {
            JSFunc.alertBack("í˜ì´ì§€ ë²ˆí˜¸ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.", response);
            return false;
        }
        
        if (searchCategory != null && !searchCategory.trim().isEmpty()
            && searchValue != null && !searchValue.trim().isEmpty()) {
            if (!("productName".equals(searchCategory) || "sellerId".equals(searchCategory))) {
                JSFunc.alertBack("ìœ íš¨í•˜ì§€ ì•Šì€ ê²€ìƒ‰ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤: " + searchCategory, response);
                return false;
            }
        }
        return true;
    }
if (!validateListParameters(pageNo, searchCategory, searchValue, response)) {
                return null;
            }
```


## ğŸ¯ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### 1. ì œê³  ê´€ë¦¬ ë¡œì§ ìµœì í™” (ë‹´ë‹¹ì : í•œì¸ê·œ)
#### ë¬¸ì œìƒí™©
- ê²°ì œ ì‹œ ì¬ê³  ìˆ˜ëŸ‰ ì²´í¬ì™€ ìƒíƒœ ë³€ê²½ì„ ìœ„í•´ DBì— ì¤‘ë³µ ì ‘ê·¼ ë°œìƒ
- ë™ì‹œ ì£¼ë¬¸ ì‹œ ì¬ê³  ê´€ë¦¬ì˜ ì¼ê´€ì„± ë³´ì¥ í•„ìš”

#### í•´ê²° ë°©ì•ˆ
- í”„ë¡œì‹œì €ë¥¼ í™œìš©í•œ ì¬ê³  ê´€ë¦¬ ë¡œì§ ìµœì í™”

#### ê°œì„  íš¨ê³¼
- DB ì ‘ê·¼ íšŸìˆ˜ ê°ì†Œë¡œ ì„±ëŠ¥ í–¥ìƒ
- ì¬ê³  ê´€ë¦¬ ë¡œì§ ì¤‘ì•™í™”ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
***
### 2. ë¦¬ëˆ…ìŠ¤ í™˜ê²½ íŒŒì¼ ì—…ë¡œë“œ ê²½ë¡œ ë¬¸ì œ (ë‹´ë‹¹ì : ê°•ê²½ë¯¼)
#### ë¬¸ì œ ìƒí™©
- ìœˆë„ìš° í™˜ê²½ì—ì„œ ê°œë°œëœ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì´ ë¦¬ëˆ…ìŠ¤ ì„œë²„ ë°°í¬ í›„ ì‘ë™ ë¶ˆê°€
- Tomcat ë‚´ë¶€ ë””ë ‰í† ë¦¬ ì‚¬ìš© ì‹œë„ ì‹¤íŒ¨

#### í•´ê²° ë°©ë²•
- ì™¸ë¶€ ë””ë ‰í† ë¦¬ ê²½ë¡œ ì„¤ì • ë° file í”„ë¡œí† ì½œ ì ìš©
```java
@Override
public void addResourceHandlers(ResourceHandlerRegistry registry) {
    // ì™¸ë¶€ ê²½ë¡œ íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
    registry.addResourceHandler("/uploads/**")
            .addResourceLocations("file:///home/gyeongmini/uploads/")
            .setCachePeriod(3600);
            // ë¸Œë¼ìš°ì € ìºì‹œ ì„¤ì •ì„ í†µí•´ ì„±ëŠ¥ ìµœì í™”
    // ì •ì  ë¦¬ì†ŒìŠ¤ ì„¤ì •
    registry.addResourceHandler("/resources/**")
            .addResourceLocations("/resources/");
}
```

#### ê°œì„  íš¨ê³¼
- ìš´ì˜ì²´ì œ ë…ë¦½ì ì¸ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ ê°€ëŠ¥
- íŒŒì¼ ì ‘ê·¼ ë³´ì•ˆ ê°•í™”
- ìºì‹œ ì„¤ì •ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
***
### 3. ì§€ë„ API ì—°ë™ ë¬¸ì œ (ë‹´ë‹¹ì : ìµœì‚¬ë‘)
#### ë¬¸ì œ ìƒí™©
- ê¸°ì¡´ API ë“±ë¡ì„ localhostë¡œ ë“±ë¡í•˜ì—¬ ë°°í¬ í›„ ì§€ë„ í‘œì‹œ ë¶ˆê°€

#### í•´ê²° ë°©ë²•
- ë„¤ì´ë²„ ì§€ë„ API ë“±ë¡ì„ ë°°í¬ì‹œ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì§€ë„ í‘œì‹œ ë¬¸ì œ í•´ê²°

#### ê°œì„  íš¨ê³¼
- ë°°í¬ í›„ì—ë„ ì§€ë„ í‘œì‹œ ê°€ëŠ¥
- ì§€ë„ API ì—°ë™ ë¬¸ì œ í•´ê²°
***
